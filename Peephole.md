**Peephole optimization** - оптимизация выполняется на маленьком **наборе инструкций компилятора**(**peephole**, **window**) - мы его заменяем аналогичным набором, который выполняется быстрее или занимает меньше памяти. При некоторых техниках приходится делать предположения(или точно знать), что одна инструкция будет выполняться быстрее другой. Часто компиляторы выполняют данный тип оптимизации при помощи **pattern matching algorithm**.

Цели:
1) увеличить производительность;
2) уменьшить размер кода;
3) уменьшиить объем занимаемой памяти(memory footprint).

Разные техники:

1) **Constant folding** - вычисление, состоящее из констант, может быть вычислено во время компиляции.

   Было:
   ```
      x = 2 * 3;
   ```
   
   Стало:
   ```
      x = 6;
   ```
---------------------------------------------------------------------------------------------------------

2) **Redundant load and store elimination** / **Redundant code elimination** - удаляем лишние инструкции.

   Было:
   ```
      y = x + 5;
      i = y;
      z = i;
      w = z * 3;
   ```

   Стало:
   ```
      y = x + 5;
      w = y * 3;
   ```

   Было:
   ```
      MOV b, R0
      ADD c, R0
      MOV R0, a
      MOV a, R0
      ADD e, R0
      MOV R0, d
   ```

   Стало:
   ```
      MOV b, R0
      ADD c, R0
      MOV R0, a
      ADD e, R0
      MOV R0, d
   ```

   Обычно при вызове каких-либо процедур, используются PUSH и POP инструкции. Часто при последовательных вызовах процедур восстановление и сохраненеие одних и тех же регистров избыточно.

   Было:
   ```
      PUSH AF
      PUSH BC
      PUSH DE
      PUSH HL
      CALL _ADDR1
      POP HL          // Избыточно
      POP DE          // Избыточно
      POP BC          // Избыточно
      POP AF          // Избыточно
      ---------------------------
      PUSH AF         // Избыточно
      PUSH BC         // Избыточно
      PUSH DE         // Избыточно
      PUSH HL         // Избыточно
      CALL _ADDR2
      POP HL
      POP DE
      POP BC
      POP AF
   ```

   Стало:
   ```
      PUSH AF
      PUSH BC
      PUSH DE
      PUSH HL
      CALL _ADDR1
      CALL _ADDR2
      POP HL
      POP DE
      POP BC
      POP AF
   ```
---------------------------------------------------------------------------------------------------------

3) **Strength reduction** - замена одних инструкций более быстрыми инструкциями.

   Было:
   ```
      y = x * 2;
   ```

   Стало:
   ```
      y = x + x;
      y = x << 1;
   ```

   Было:
   ```
      ...
      aload 1
      aload 1
      mul
      ...
   ```

   Стало:
   ```
      ...
      aload 1
      dup         // при условии, что эта инструкция работает быстрее, чем aload
      mul
      ...
   ```
   
---------------------------------------------------------------------------------------------------------

4) **Null sequences** / **simplify algebraic expressions** - удаляем бессмысленные инструкции.

   Например:
     ```
     a = a + 0;
     a = a * 1;
     a = a / 1;
     a = a - 0;
     ```
---------------------------------------------------------------------------------------------------------

5) **Combine operations** - несколько инструкций заменяется одной эквивалентной инструкцией.

---------------------------------------------------------------------------------------------------------

6) **Deadcode elimination** - удаляем инструкции, которые либо никогда не выполняются, либо не производят никакого эффекта.

   Было:
     ```
     int Dead(void) {
       int a = 10;
       int z = 50;
       int c;
       c = z * 5;
       printf(c);
       a = 20;      // нам не нужна эта инструкция
       a = a * 10;  // нам не нужна эта инструкция
       return 0;
     }
     ```
   
   Стало:
     ```
     int Dead(void) {
       int a = 10;
       int z = 50;
       int c;
       c = z * 5;
       printf(c);
       return 0;
     }
     ```
     
   
